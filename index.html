<!doctype html>
<!--
  MonkeyType-like Typing Test (single-file)
  Features:
  - Multiple test modes: Time, Words, Characters, Paragraph
  - Random meaningful paragraph generator on demand
  - Live WPM / Accuracy / CPM / Time / Stats
  - Light/Dark mode, theme color accents, saved to localStorage
  - Pure HTML/CSS/Vanilla JS (no libraries)

  Save this file as index.html and open in your browser.
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TypeSprint — Minimal MonkeyType-like Typing Test</title>
  <style>
    :root{
      --bg: #0f1724;
      --panel: #0b1220;
      --text: #e6eef8;
      --muted: #a6b4c8;
      --accent: #6ee7b7; /* default accent */
      --accent-contrast: #06281f;
      --card-radius: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
      --ui-radius: 8px;
    }
    .light{
      --bg: #f7f9fc;
      --panel: #ffffff;
      --text: #0b1220;
      --muted: #4b5870;
    }
    body{
      background: radial-gradient(1200px 600px at 10% 10%, rgba(0,0,0,0.08), transparent), var(--bg);
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
      box-sizing:border-box;
    }
    .container{
      width:100%;
      max-width:1100px;
      display:grid;
      gap:20px;
      grid-template-columns: 1fr 360px;
      align-items:start;
    }
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      padding:20px;
      border-radius:var(--card-radius);
      box-shadow: 0 6px 30px rgba(2,6,23,0.5);
      border: 1px solid rgba(255,255,255,0.03);
    }
    .left .panel{min-height:420px}
    header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    select,input[type=number]{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;color:var(--text)}
    button{background:var(--accent);color:var(--accent-contrast);border:none;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer}
    .typing-area{
      background:var(--panel);
      padding:18px;border-radius:12px;min-height:180px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid rgba(0,0,0,0.2);
    }
    .text-line{font-size:28px;line-height:1.4;word-wrap:break-word;text-align:left;max-width:100%;}
    .word{display:inline-block;margin-right:8px}
    .char{opacity:0.85}
    .char.correct{color:var(--accent);font-weight:600}
    .char.incorrect{background:linear-gradient(90deg, rgba(255,0,0,0.12), transparent);color:#ff7b7b}
    .char.current{border-bottom:2px solid var(--accent);padding-bottom:2px}

    .stats{display:flex;gap:12px;margin-top:12px}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));padding:10px;border-radius:10px;min-width:90px;text-align:center}
    .small{font-size:12px;color:var(--muted)}
    .big{font-size:20px;font-weight:700}

    /* Right column */
    .right{position:relative}
    .settings{display:grid;gap:10px}
    label{display:flex;flex-direction:column;font-size:13px;color:var(--muted)}
    .theme-pills{display:flex;gap:8px;flex-wrap:wrap}
    .pill{padding:8px;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .accent-swatch{width:32px;height:24px;border-radius:6px;display:inline-block;border:1px solid rgba(0,0,0,0.2)}
    .footer{font-size:13px;color:var(--muted);margin-top:16px}

    /* Responsive */
    @media (max-width:980px){
      .container{grid-template-columns:1fr;}
      .right{order:2}
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="left">
      <div class="panel">
        <header>
          <h1>TypeSprint</h1>
          <div class="controls">
            <select id="modeSelect" title="Test mode">
              <option value="time">Time</option>
              <option value="words">Words</option>
              <option value="chars">Characters</option>
              <option value="paragraph">Paragraph</option>
            </select>
            <input id="modeValue" type="number" min="10" value="60" style="width:84px" />
            <button id="startBtn">Start</button>
            <button id="resetBtn">Reset</button>
          </div>
        </header>

        <div class="typing-area">
          <div>
            <div class="text-line" id="textLine" tabindex="0"></div>
            <div class="small" style="margin-top:10px">Click the text area and start typing. Backspace allowed. Mistakes are marked in red.</div>
          </div>
        </div>

        <div class="stats">
          <div class="stat"><div class="small">WPM</div><div id="wpm" class="big">0</div></div>
          <div class="stat"><div class="small">Accuracy</div><div id="acc" class="big">100%</div></div>
          <div class="stat"><div class="small">CPM</div><div id="cpm" class="big">0</div></div>
          <div class="stat"><div class="small">Time</div><div id="timeLeft" class="big">0</div></div>
        </div>

      </div>
      <!-- extra controls under left -->
      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button id="copyBtn">Copy current text</button>
        <button id="generateBtn">Generate Paragraph</button>
        <label style="margin-left:8px"><input id="showCaret" type="checkbox" checked /> Show caret</label>
      </div>
    </div>

    <div class="right">
      <div class="panel settings">
        <label>Theme
          <div style="display:flex;gap:8px;margin-top:8px">
            <div class="pill" id="lightToggle">Light</div>
            <div class="pill" id="darkToggle">Dark</div>
          </div>
        </label>

        <label>Accent colors
          <div class="theme-pills" style="margin-top:8px">
            <div class="pill color" data-color="#6ee7b7"><span class="accent-swatch" style="background:#6ee7b7"></span></div>
            <div class="pill color" data-color="#60a5fa"><span class="accent-swatch" style="background:#60a5fa"></span></div>
            <div class="pill color" data-color="#f472b6"><span class="accent-swatch" style="background:#f472b6"></span></div>
            <div class="pill color" data-color="#f59e0b"><span class="accent-swatch" style="background:#f59e0b"></span></div>
            <div class="pill color" data-color="#34d399"><span class="accent-swatch" style="background:#34d399"></span></div>
            <div class="pill color" data-color="#a78bfa"><span class="accent-swatch" style="background:#a78bfa"></span></div>
          </div>
        </label>

        <label>Test presets
          <div style="display:flex;gap:8px;margin-top:8px">
            <div class="pill" id="preset30">30s</div>
            <div class="pill" id="preset60">60s</div>
            <div class="pill" id="preset120">120s</div>
            <div class="pill" id="preset25w">25 words</div>
          </div>
        </label>

        <label>Custom Text
          <textarea id="customText" rows="4" placeholder="Paste custom text here to use for the Paragraph mode"></textarea>
        </label>

        <div class="footer">Made with ❤️ — single-file JS example. Save local settings in your browser.</div>
      </div>
    </div>
  </div>

  <script>
    /* ====== Core data and utilities ====== */
    const SAMPLE_SENTENCES = [
      "Rice paddies stretched across the valley, reflecting the pale sky like mirrors of green and silver.",
      "Farmers walked slowly along the narrow embankments, checking the young shoots for signs of disease.",
      "A soft breeze carried the scent of wet earth and distant blossoms across the field.",
      "Sunlight caught on the dew, turning each drop into a tiny, trembling star.",
      "Ancient irrigation channels threaded through the land, their stones smoothed by generations of water.",
      "Children chased one another along the path, their laughter mixing with the calls of distant birds.",
      "In the village, smoke curled from chimneys as the evening meal was prepared in clay stoves.",
      "A weathered journal lay beside the farmer's hand, filled with notes about planting and harvest.",
      "Clouds gathered on the horizon, promising rain that would bring both relief and work.",
      "Under the great banyan tree, neighbors compared seeds and swapped stories about seasons past."
    ];

    function generateParagraph(sentenceCount = 5){
      const out = [];
      for(let i=0;i<sentenceCount;i++){
        const s = SAMPLE_SENTENCES[Math.floor(Math.random()*SAMPLE_SENTENCES.length)];
        out.push(s);
      }
      // Make slight variations to avoid obvious duplicates
      return out.join(' ');
    }

    /* ====== Elements ====== */
    const textLine = document.getElementById('textLine');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const modeSelect = document.getElementById('modeSelect');
    const modeValue = document.getElementById('modeValue');
    const wpmEl = document.getElementById('wpm');
    const accEl = document.getElementById('acc');
    const cpmEl = document.getElementById('cpm');
    const timeLeftEl = document.getElementById('timeLeft');
    const generateBtn = document.getElementById('generateBtn');
    const copyBtn = document.getElementById('copyBtn');
    const customText = document.getElementById('customText');

    /* ====== State ====== */
    let testText = '';
    let chars = []; // {char, el, status: 'pending'|'correct'|'incorrect'}
    let caretIndex = 0;
    let started = false;
    let finished = false;
    let startTime = null;
    let timerInterval = null;
    let totalTyped = 0;
    let incorrectTyped = 0;
    let mode = 'time';
    let modeTarget = 60; // seconds or count depending
    let timeRemaining = 60;

    /* ====== Theme persistence ====== */
    const savedTheme = localStorage.getItem('typesprint_theme') || 'dark';
    const savedAccent = localStorage.getItem('typesprint_accent') || '#6ee7b7';
    if(savedTheme === 'light') document.documentElement.classList.add('light');
    document.documentElement.style.setProperty('--accent', savedAccent);

    /* ====== Render text into spans ====== */
    function loadText(txt){
      testText = txt.replace(/\s+/g,' ').trim();
      chars = [];
      textLine.innerHTML = '';
      // split into words but keep spaces for rendering
      for(let i=0;i<testText.length;i++){
        const ch = testText[i];
        const span = document.createElement('span');
        span.className = 'char';
        span.textContent = ch;
        textLine.appendChild(span);
        chars.push({char: ch, el: span, status: 'pending'});
      }
      caretIndex = 0;
      renderCaret();
      resetStats();
    }

    function renderCaret(){
      chars.forEach((c, idx)=>{
        c.el.classList.remove('current','correct','incorrect');
        if(c.status==='correct') c.el.classList.add('correct');
        if(c.status==='incorrect') c.el.classList.add('incorrect');
      });
      if(chars[caretIndex]) chars[caretIndex].el.classList.add('current');
      // scroll into view if necessary
      const cur = chars[caretIndex]?.el;
      if(cur){
        const rect = cur.getBoundingClientRect();
        const parentRect = textLine.getBoundingClientRect();
        if(rect.right > parentRect.right || rect.left < parentRect.left){
          cur.scrollIntoView({behavior:'smooth',inline:'center'});
        }
      }
    }

    /* ====== Stats ====== */
    function resetStats(){
      started = false; finished = false; startTime = null;
      clearInterval(timerInterval); timerInterval=null;
      totalTyped = 0; incorrectTyped = 0;
      updateStats();
      timeRemaining = (mode==='time')? modeTarget : modeTarget; // for time mode default
      timeLeftEl.textContent = timeRemaining;
    }

    function updateStats(){
      const elapsed = startTime ? (Date.now()-startTime)/1000 : 0;
      const minutes = Math.max(elapsed/60, 1/60);
      // Count correct chars
      const correct = chars.filter(c=>c.status==='correct').length;
      const typed = totalTyped;
      const wpm = Math.round((correct/5)/minutes) || 0;
      const cpm = Math.round((correct)/minutes) || 0;
      const acc = typed>0? Math.max(0,Math.round((correct/typed)*100)) : 100;
      wpmEl.textContent = wpm;
      cpmEl.textContent = cpm;
      accEl.textContent = acc + '%';
    }

    /* ====== Timer loop ====== */
    function startTimer(){
      if(timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(()=>{
        if(mode==='time'){
          timeRemaining = Math.max(0, timeRemaining-1);
          timeLeftEl.textContent = timeRemaining;
          if(timeRemaining<=0){ finishTest(); }
        } else {
          // for words/chars/paragraph modes, update elapsed displayed
          const elapsed = Math.max(0, Math.floor((Date.now()-startTime)/1000));
          timeLeftEl.textContent = elapsed;
        }
        updateStats();
      }, 1000);
    }

    function finishTest(){
      finished = true;
      clearInterval(timerInterval);
      textLine.blur && textLine.blur();
      updateStats();
      startBtn.textContent = 'Restart';
    }

    /* ====== Key handling ====== */
    function handleKey(e){
      if(finished) return;
      if(!started){
        started = true;
        startTime = Date.now();
        startTimer();
      }
      // Allow typical editing keys: Backspace
      if(e.key === 'Backspace'){
        if(caretIndex>0){
          caretIndex--;
          // if previous was incorrect, decrement incorrect counter
          if(chars[caretIndex].status === 'incorrect') incorrectTyped = Math.max(0, incorrectTyped-1);
          if(chars[caretIndex].status === 'correct'){} // nothing
          chars[caretIndex].status = 'pending';
          renderCaret();
          totalTyped = Math.max(0, totalTyped-1);
          return;
        }
      }
      if(e.key.length === 1){
        // printable
        const expected = chars[caretIndex]?.char;
        if(typeof expected === 'undefined'){
          // extra typed beyond length -> ignore or count as incorrect
          totalTyped++;
          incorrectTyped++;
          updateStats();
          return;
        }
        const typed = e.key;
        totalTyped++;
        if(typed === expected){
          chars[caretIndex].status = 'correct';
        } else {
          chars[caretIndex].status = 'incorrect';
          incorrectTyped++;
        }
        caretIndex++;
        renderCaret();

        // Check end conditions for non-time modes
        if(mode === 'words'){
          // words mode: stop when number of spaces encountered equals target or caret at end
          const typedWords = testText.slice(0, caretIndex).split(/\s+/).filter(Boolean).length;
          if(typedWords >= modeTarget || caretIndex >= chars.length) finishTest();
        }
        if(mode === 'chars'){
          if(caretIndex >= modeTarget || caretIndex >= chars.length) finishTest();
        }
        if(mode === 'paragraph'){
          if(caretIndex >= chars.length) finishTest();
        }
        updateStats();
      }
    }

    /* ====== UI actions ====== */
    startBtn.addEventListener('click', ()=>{
      if(started && !finished){
        // if running - do nothing or pause? We'll restart
        resetAllAndLoadCurrent();
        startBtn.textContent = 'Start';
      } else {
        if(finished) resetAllAndLoadCurrent();
        // start test
        started=false; finished=false; totalTyped=0; incorrectTyped=0;
        if(mode==='time') timeRemaining = modeTarget;
        startBtn.textContent = 'Running...';
        // focus area to capture keyboard
        textLine.focus();
      }
    });

    resetBtn.addEventListener('click', ()=>{
      resetAllAndLoadCurrent();
    });

    function resetAllAndLoadCurrent(){
      clearInterval(timerInterval); timerInterval=null;
      // Load according to mode
      mode = modeSelect.value;
      modeTarget = parseInt(modeValue.value) || 60;
      if(mode==='time'){
        // if text shorter than needs, generate longer
        if(testText.length < 200) loadText(generateParagraph(6));
        timeRemaining = modeTarget;
      } else if(mode==='words'){
        // generate words count
        const wordsNeeded = modeTarget || 25;
        const p = generateParagraph(Math.ceil(wordsNeeded/10)+1);
        // take only first N words
        const w = p.split(/\s+/).slice(0, wordsNeeded).join(' ');
        loadText(w);
      } else if(mode==='chars'){
        // ensure text length >= target
        let s = generateParagraph(Math.ceil((modeTarget||100)/40)+1);
        loadText(s.slice(0, modeTarget));
      } else if(mode==='paragraph'){
        if(customText.value.trim()) loadText(customText.value.trim());
        else loadText(generateParagraph(5));
      }
      resetStats();
      startBtn.textContent = 'Start';
    }

    // capture keys globally when focus on page
    window.addEventListener('keydown', (e)=>{
      // prevent unintended scrolling for spacebar
      if(document.activeElement === document.body || document.activeElement === textLine) e.preventDefault();
      handleKey(e);
    });

    // change mode ui
    modeSelect.addEventListener('change', ()=>{
      const m = modeSelect.value;
      if(m==='time') modeValue.value = 60;
      else if(m==='words') modeValue.value = 25;
      else if(m==='chars') modeValue.value = 200;
      else if(m==='paragraph') modeValue.value = 1;
    });

    modeValue.addEventListener('change', ()=>{ /* no-op for now */ });

    // presets
    document.getElementById('preset30').addEventListener('click', ()=>{ modeSelect.value='time'; modeValue.value=30; resetAllAndLoadCurrent(); });
    document.getElementById('preset60').addEventListener('click', ()=>{ modeSelect.value='time'; modeValue.value=60; resetAllAndLoadCurrent(); });
    document.getElementById('preset120').addEventListener('click', ()=>{ modeSelect.value='time'; modeValue.value=120; resetAllAndLoadCurrent(); });
    document.getElementById('preset25w').addEventListener('click', ()=>{ modeSelect.value='words'; modeValue.value=25; resetAllAndLoadCurrent(); });

    // generate paragraph
    generateBtn.addEventListener('click', ()=>{
      const p = generateParagraph(5);
      loadText(p);
    });

    copyBtn.addEventListener('click', ()=>{
      navigator.clipboard.writeText(testText).then(()=>{
        alert('Text copied to clipboard');
      });
    });

    // Theme toggles
    document.getElementById('lightToggle').addEventListener('click', ()=>{
      document.documentElement.classList.add('light');
      localStorage.setItem('typesprint_theme','light');
    });
    document.getElementById('darkToggle').addEventListener('click', ()=>{
      document.documentElement.classList.remove('light');
      localStorage.setItem('typesprint_theme','dark');
    });
    document.querySelectorAll('.pill.color').forEach(p=>{
      p.addEventListener('click', ()=>{
        const c = p.dataset.color;
        document.documentElement.style.setProperty('--accent', c);
        localStorage.setItem('typesprint_accent', c);
      });
    });

    // initial load
    (function init(){
      // load default paragraph
      loadText(generateParagraph(5));
      // parse initial mode
      mode = modeSelect.value; modeTarget = parseInt(modeValue.value);
      resetStats();
    })();

    // small accessibility: focus text container when clicked
    textLine.addEventListener('click', ()=> textLine.focus());

  </script>
</body>
</html>
